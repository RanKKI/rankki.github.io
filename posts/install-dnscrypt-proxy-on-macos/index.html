<!doctype html><html lang=zh-cn><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>在 macOS 上使用 DNSCrypt-Proxy | RanKKI's Blog</title>
<link rel=canonical href=https://rankki.xyz/posts/install-dnscrypt-proxy-on-macos/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:url" content="https://rankki.xyz/posts/install-dnscrypt-proxy-on-macos/"><meta property="og:site_name" content="RanKKI's Blog"><meta property="og:title" content="在 macOS 上使用 DNSCrypt-Proxy"><meta property="og:description" content="DNSCrypt是一个介于客户端和 DNS 服务商之间的认证式通讯协议，通俗来讲，DNSCrypt 阻止了运营商对你的 DNS 恶意劫持。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2018-06-11T09:17:53+00:00"><meta property="article:modified_time" content="2021-09-18T18:42:24+08:00"><meta property="article:tag" content="DNS"><meta name=twitter:card content="summary"><meta name=twitter:title content="在 macOS 上使用 DNSCrypt-Proxy"><meta name=twitter:description content="DNSCrypt是一个介于客户端和 DNS 服务商之间的认证式通讯协议，通俗来讲，DNSCrypt 阻止了运营商对你的 DNS 恶意劫持。"><link rel=stylesheet href=https://rankki.xyz/css/styles.703587cbc83e3d6c4abb083f3126cd73c5c67af0782c70bbc9e4643c1d171ec879a51fed1fd12cf82e0469fc4c2454f83d63696957494d2268aa2cc691a4ef06.css><link rel=stylesheet href=https://rankki.xyz/css/syntax.css><link rel=stylesheet href=https://rankki.xyz/css/loading.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://rankki.xyz/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><header id=header><a href=https://rankki.xyz/><div id=title><h1>RanKKI's Blog</h1></div></a><div id=nav><ul><li class=icon><a href=# aria-label=Menu><i class="fas fa-bars fa-2x" aria-hidden=true></i></a></li><li><a href=/>Home</a></li><li><a href=/about>About</a></li><li><a href=/tags>Tags</a></li></ul></div></header><div id=header-post><span id=menu><div id=toc><nav id=TableOfContents><ul><li><a href=#开始安装>开始安装</a><ul><li><a href=#安装-homebrew>安装 Homebrew</a></li><li><a href=#安装-dnscrypt-proxy>安装 DNSCrypt-Proxy</a></li><li><a href=#配置-dnscrypt-proxy>配置 DNSCrypt-Proxy</a></li><li><a href=#启动-dnscrypt-proxy>启动 DNSCrypt-Proxy</a></li></ul></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">在 macOS 上使用 DNSCrypt-Proxy</h1><div class=meta><div class=postdate><time datetime="2018-06-11 09:17:53 +0000 UTC" itemprop=datePublished>2018-06-11</time>
(Updated: <time datetime="2021-09-18 18:42:24 +0800 CST" itemprop=dateModified>2021-09-18</time>)</div><div class=article-read-time><i class="far fa-clock"></i>
3 minute read</div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/dns rel=tag>DNS</a></div></div></header><div class=content itemprop=articleBody><p><a href=https://dnscrypt.info>DNSCrypt</a>是一个介于客户端和 DNS 服务商之间的认证式通讯协议，通俗来讲，DNSCrypt 阻止了运营商对你的 DNS 恶意劫持。</p><p>DNSCrypt 支持各个平台，因为我用的是 macOS，所以就拿 macOS 举例，其他平台可以去 dnscrypt.info 查看更多信息。</p><h2 id=开始安装>开始安装</h2><h3 id=安装-homebrew>安装 Homebrew</h3><p><a href=https://brew.sh>Homebrew</a>是 macOS 上的软件包管理器，他可以安装苹果没有预装的软件，比如 <code>$ brew install wget</code></p><p>首先需要打开终端，输入</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ /usr/bin/ruby -e <span class=s2>&#34;</span><span class=k>$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install<span class=k>)</span><span class=s2>&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>然后就会自动开始安装，期间会让你输入密码并安装 Xcode Command Line Tools，然后喝杯咖啡去吧。回来之后就安装好了。</p><h3 id=安装-dnscrypt-proxy>安装 DNSCrypt-Proxy</h3><p>直接在终端输入 <code>$ brew install dnscrypt-proxy</code>，然后稍等一下就安装了。但是在使用之前需要做一点小配置。</p><h3 id=配置-dnscrypt-proxy>配置 DNSCrypt-Proxy</h3><p>无论是 Vim 还是 nano 还是 Visual Studio Code，只要是能编辑文本的软件就好，打开 <code>/usr/local/etc/dnscrypt-proxy.toml</code>，然后修改几个选项。</p><h4 id=应用日志>应用日志</h4><p>程序有任何运行错误都可以在这个日志文件中查看。</p><p>找到 log_level，修改如下，哦对，macOS 默认是没有<code>/usr/local/var/log/</code>文件夹，需要在<code>/usr/local/var/</code> 目录下 <code>mkdir log</code></p><pre tabindex=0><code>log_level = 0
log_file = &#39;/usr/local/var/log/dnscrypt-proxy.log&#39;
</code></pre><h4 id=查询日志>查询日志。</h4><p>这个日志记录了每一个 dns 查询的时间，在 <code>dnscrypt-proxy.toml</code> 搜索 query_log 并设置为</p><pre tabindex=0><code>file = &#39;/usr/local/var/log/query.log&#39;
</code></pre><h4 id=nx-日志>NX 日志</h4><p>NX 日志记录着那些不存在的域名，在 <code>dnscrypt-proxy.toml</code> 搜索 nx_log 并设置为</p><pre tabindex=0><code>file = &#39;/usr/local/var/log/nx.log&#39;
</code></pre><h4 id=禁用系统-dns>禁用系统 DNS</h4><p>不使用 macOS 自带的域名解析。在 <code>dnscrypt-proxy.toml</code> 搜索 ignore_system_dns 并设置为</p><pre tabindex=0><code>ignore_system_dns = true
</code></pre><h3 id=启动-dnscrypt-proxy>启动 DNSCrypt-Proxy</h3><p>在终端中输入</p><pre tabindex=0><code>$ sudo brew services start dnscrypt-proxy
</code></pre><p>然后可以查看 dnscrypt-proxy.log 文件，应该可以看到 dnscrypt-proxy is ready.</p><p>之后在将 网络设置中的 DNS 改成 <code>127.0.0.1</code> 即可。</p></div></article><footer id=footer><div class=footer-left>Copyright &copy; 2024 Hugh(Hui) Liu</div><script src=https://code.iconify.design/2/2.0.4/iconify.min.js></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "7f02cdd7074d4e1f8125c11651f47699"}'></script></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script></html>