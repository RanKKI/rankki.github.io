<!doctype html><html lang=zh-cn><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>在旧芯片组使用 NVMe SSD 安装 Ubuntu | RanKKI's Blog</title>
<link rel=canonical href=https://rankki.xyz/posts/install-ubuntu-with-nvme-on-old-chipset-motherboard/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:url" content="https://rankki.xyz/posts/install-ubuntu-with-nvme-on-old-chipset-motherboard/"><meta property="og:site_name" content="RanKKI's Blog"><meta property="og:title" content="在旧芯片组使用 NVMe SSD 安装 Ubuntu"><meta property="og:description" content="前情提要 手上有一个 H61 芯片组的主板的 NAS， 4 个 SATA 口和硬盘位。毕竟主板那么旧了，也没有 M.2 接口。最一开始是把 OS 安装到了 U 盘上，后来搬家，U 盘丢了，就说顺手升级一下系统盘。
于是乎，买了 PCI-E 转 M.2 接口的 adapter 和一块 NVMe M.2 的 WD SN570.
普通安装 直接做了个 Ubuntu Server 的安装盘，并直接在 NAS 上进行安装，发现找不到盘。于是，将 NVMe SSD 拆到 PC 上进行安装，同时将引导安装到 SSD 上。
当还是启动不来，一番搜索得出1
可能是主板太老，BIOS 没有对 NVMe 盘的支持。但可以通过 Clovers 这种引导启动
安装 Clovers 使用这种方法的坏处就是，你需要一个 U 盘做启动盘，但系统还在 SSD 上， 相比于 U 盘做系统盘，速度好了很多。
但刷完引导发现引导里并没有 Ubuntu Server。
盘没有读取成功 进入到安装盘带的 Shell 里，运行 fdisk --list 和 lshw 发现根本找不到 NVMe 的设备。"><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-03-04T10:19:00+11:00"><meta property="article:modified_time" content="2023-03-04T16:02:19+11:00"><meta property="article:tag" content="NVMe"><meta property="article:tag" content="Linux"><meta property="article:tag" content="H61"><meta name=twitter:card content="summary"><meta name=twitter:title content="在旧芯片组使用 NVMe SSD 安装 Ubuntu"><meta name=twitter:description content="前情提要 手上有一个 H61 芯片组的主板的 NAS， 4 个 SATA 口和硬盘位。毕竟主板那么旧了，也没有 M.2 接口。最一开始是把 OS 安装到了 U 盘上，后来搬家，U 盘丢了，就说顺手升级一下系统盘。
于是乎，买了 PCI-E 转 M.2 接口的 adapter 和一块 NVMe M.2 的 WD SN570.
普通安装 直接做了个 Ubuntu Server 的安装盘，并直接在 NAS 上进行安装，发现找不到盘。于是，将 NVMe SSD 拆到 PC 上进行安装，同时将引导安装到 SSD 上。
当还是启动不来，一番搜索得出1
可能是主板太老，BIOS 没有对 NVMe 盘的支持。但可以通过 Clovers 这种引导启动
安装 Clovers 使用这种方法的坏处就是，你需要一个 U 盘做启动盘，但系统还在 SSD 上， 相比于 U 盘做系统盘，速度好了很多。
但刷完引导发现引导里并没有 Ubuntu Server。
盘没有读取成功 进入到安装盘带的 Shell 里，运行 fdisk --list 和 lshw 发现根本找不到 NVMe 的设备。"><link rel=stylesheet href=https://rankki.xyz/css/styles.703587cbc83e3d6c4abb083f3126cd73c5c67af0782c70bbc9e4643c1d171ec879a51fed1fd12cf82e0469fc4c2454f83d63696957494d2268aa2cc691a4ef06.css><link rel=stylesheet href=https://rankki.xyz/css/syntax.css><link rel=stylesheet href=https://rankki.xyz/css/loading.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://rankki.xyz/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><header id=header><a href=https://rankki.xyz/><div id=title><h1>RanKKI's Blog</h1></div></a><div id=nav><ul><li class=icon><a href=# aria-label=Menu><i class="fas fa-bars fa-2x" aria-hidden=true></i></a></li><li><a href=/>Home</a></li><li><a href=/about>About</a></li><li><a href=/tags>Tags</a></li></ul></div></header><div id=header-post><span id=menu><div id=toc><nav id=TableOfContents><ul><li><a href=#安装-clovers>安装 Clovers</a></li><li><a href=#盘没有读取成功>盘没有读取成功</a></li></ul><ul><li><a href=#找不到盘>找不到盘</a><ul><li><a href=#解决方案>解决方案</a></li></ul></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">在旧芯片组使用 NVMe SSD 安装 Ubuntu</h1><div class=meta><div class=postdate><time datetime="2023-03-04 10:19:00 +1100 +1100" itemprop=datePublished>2023-03-04</time></div><div class=article-read-time><i class="far fa-clock"></i>
3 minute read</div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/nvme rel=tag>NVMe</a>
,
<a class=tag-link href=/tags/linux rel=tag>Linux</a>
,
<a class=tag-link href=/tags/h61 rel=tag>H61</a></div></div></header><div class=content itemprop=articleBody><h1 id=前情提要>前情提要</h1><p>手上有一个 H61 芯片组的主板的 NAS， 4 个 SATA 口和硬盘位。毕竟主板那么旧了，也没有 M.2 接口。最一开始是把 OS 安装到了 U 盘上，后来搬家，U 盘丢了，就说顺手升级一下系统盘。</p><p>于是乎，买了 PCI-E 转 M.2 接口的 adapter 和一块 NVMe M.2 的 WD SN570.</p><h1 id=普通安装>普通安装</h1><p>直接做了个 Ubuntu Server 的安装盘，并直接在 NAS 上进行安装，发现找不到盘。于是，将 NVMe SSD 拆到 PC 上进行安装，同时将引导安装到 SSD 上。</p><p>当还是启动不来，一番搜索得出<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><blockquote><p>可能是主板太老，BIOS 没有对 NVMe 盘的支持。但可以通过 Clovers 这种引导启动</p></blockquote><h2 id=安装-clovers>安装 Clovers</h2><p>使用这种方法的坏处就是，你需要一个 U 盘做启动盘，但系统还在 SSD 上， 相比于 U 盘做系统盘，速度好了很多。</p><p>但刷完引导发现引导里并没有 Ubuntu Server。</p><h2 id=盘没有读取成功>盘没有读取成功</h2><p>进入到安装盘带的 Shell 里，运行 <code>fdisk --list</code> 和 <code>lshw</code> 发现根本找不到 NVMe 的设备。</p><p>通过各种调试，发现需要在 BIOS 把 PCI Express Port 从 <code>auto</code> 改成 <code>enabled</code>，能找到设备了，但引导依旧没用。</p><h1 id=使用-sata-盘做引导>使用 SATA 盘做引导</h1><p>在搜索 <code>linux pci-e nvme</code> 关键词的时候，看到一个 Linux 可以把 <code>/boot</code> 目录做到 SATA 硬盘中，系统 <code>/</code> 还是放在 NVMe SSD 中，</p><p>于是重新安装。</p><h2 id=找不到盘>找不到盘</h2><p>进入系统之后，显示找不到系统盘 (<code>/</code> 目录对应的盘)。</p><p>OS 是通过每个盘独立、唯一的 UUID 标识符加载的。因为系统盘加载失败，会回退到 <code>/boot</code> 里的 busybox, 查看 <code>/dev/</code> 下的盘符，没有找到 <code>NVMe</code> 系统盘。</p><h3 id=解决方案>解决方案</h3><p>通过安装盘 <code>installer</code> 进入到 <code>shell</code> 里， 修改 <code>boot</code> 目录下 <code>grubenv</code> 文件</p><p>注意这里需要使用工具 <code>grub2-editenv</code> 修改，不能直接用过 vim 之类的软件修改。</p><p><code>grub2-editenv grubenv set nvme_load=YES</code></p><p>重启，就能顺利的进入系统了。</p><h1 id=丢引导>丢引导</h1><p>引导出错，可以在 Live CD 中进行恢复，参考 <a href=https://web.archive.org/web/20190630193946/http://karuppuswamy.com/wordpress/2010/06/02/how-to-chroot-to-ubuntu-using-live-cd-to-fix-grub-rescue-prompt/>How to chroot Ubuntu using Live CD to fix GRUB rescue prompt</a></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://www.jianshu.com/p/5ee140b47642>2020最新攻略：免刷BIOS 老电脑用NVMe固态盘装系统！</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></article><footer id=footer><div class=footer-left>Copyright &copy; 2024 Hugh(Hui) Liu</div><script src=https://code.iconify.design/2/2.0.4/iconify.min.js></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "7f02cdd7074d4e1f8125c11651f47699"}'></script></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script></html>