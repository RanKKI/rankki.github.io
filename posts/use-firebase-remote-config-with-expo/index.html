<!doctype html><html lang=en><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>Use Firebase remote config with Expo | RanKKI's Blog</title>
<link rel=canonical href=https://rankki.xyz/posts/use-firebase-remote-config-with-expo/><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:url" content="https://rankki.xyz/posts/use-firebase-remote-config-with-expo/"><meta property="og:site_name" content="RanKKI's Blog"><meta property="og:title" content="Use Firebase remote config with Expo"><meta property="og:description" content="Firebase JS SDK does not support Remote Config by default1. The only way to use it is to eject from Expo and use a bare project with React Native Firebase.
Refactoring the current project to use a different approach is challenging, so we prefer to stay with Expo.
To use Firebase Remote Config, we can follow the instructions, but this leads to the first problem:
firebaseerror: remote config: indexed db is not supported by current browser (remoteconfig/indexed-db-unavailable)."><meta property="og:locale" content="zh_cn"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-06-20T13:15:18+11:00"><meta property="article:modified_time" content="2024-06-29T13:13:56+10:00"><meta property="article:tag" content="Expo"><meta property="article:tag" content="Firebase"><meta name=twitter:card content="summary"><meta name=twitter:title content="Use Firebase remote config with Expo"><meta name=twitter:description content="Firebase JS SDK does not support Remote Config by default1. The only way to use it is to eject from Expo and use a bare project with React Native Firebase.
Refactoring the current project to use a different approach is challenging, so we prefer to stay with Expo.
To use Firebase Remote Config, we can follow the instructions, but this leads to the first problem:
firebaseerror: remote config: indexed db is not supported by current browser (remoteconfig/indexed-db-unavailable)."><link rel=stylesheet href=https://rankki.xyz/css/styles.703587cbc83e3d6c4abb083f3126cd73c5c67af0782c70bbc9e4643c1d171ec879a51fed1fd12cf82e0469fc4c2454f83d63696957494d2268aa2cc691a4ef06.css><link rel=stylesheet href=https://rankki.xyz/css/syntax.css><link rel=stylesheet href=https://rankki.xyz/css/loading.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://rankki.xyz/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><header id=header><a href=https://rankki.xyz/><div id=title><h1>RanKKI's Blog</h1></div></a><div id=nav><ul><li class=icon><a href=# aria-label=Menu><i class="fas fa-bars fa-2x" aria-hidden=true></i></a></li><li><a href=/>Home</a></li><li><a href=/about>About</a></li><li><a href=/tags>Tags</a></li></ul></div></header><div id=header-post><span id=menu><div id=toc><nav id=TableOfContents><ul><li><a href=#indexeddb>IndexedDB</a><ul><li><a href=#mock>Mock</a></li><li><a href=#structuredclone>structuredClone</a></li></ul></li><li><a href=#firebase-error>Firebase Error</a></li><li><a href=#it-works>It works</a></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Use Firebase remote config with Expo</h1><div class=meta><div class=postdate><time datetime="2024-06-20 13:15:18 +1100 +1100" itemprop=datePublished>2024-06-20</time>
(Updated: <time datetime="2024-06-29 13:13:56 +1000 +1000" itemprop=dateModified>2024-06-29</time>)</div><div class=article-read-time><i class="far fa-clock"></i>
1 minute read</div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/expo rel=tag>Expo</a>
,
<a class=tag-link href=/tags/firebase rel=tag>Firebase</a></div></div></header><div class=content itemprop=articleBody><p><a href=https://docs.expo.dev/guides/using-firebase/#using-firebase-js-sdk>Firebase JS SDK</a> does not support Remote Config by default<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>. The only way to use it is to eject from Expo and use a bare project with <a href=https://rnfirebase.io/>React Native Firebase</a>.</p><p>Refactoring the current project to use a different approach is challenging, so we prefer to stay with Expo.</p><hr><p>To use Firebase Remote Config, we can follow the <a href="https://firebase.google.com/docs/remote-config/get-started?platform=web">instructions</a>, but this leads to the first problem:</p><pre tabindex=0><code>firebaseerror: remote config: indexed db is not supported by current browser (remoteconfig/indexed-db-unavailable).
</code></pre><h2 id=indexeddb>IndexedDB</h2><p>IndexedDB is a low-level API for client-side storage of significant amounts of structured data, including files/blobs<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>. Currently, React Native (RN) does not support IndexedDB<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>.</p><h3 id=mock>Mock</h3><p>We can use <code>fakeIndexedDB</code><sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup> to override <code>window.indexedDB</code> to simulate its presence.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=s2>&#34;fake-indexeddb/auto&#34;</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><p>This leads to another error:</p><pre tabindex=0><code>structuredClone is not defined
</code></pre><h3 id=structuredclone>structuredClone</h3><p>structuredClone is one of the <a href=https://github.com/facebook/hermes/discussions/1072#discussioncomment-6578204><code>Non-ECMAScript JS APIs</code></a><sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>, but it is required for <code>fakeIndexedDB</code>, We can mock this in the environment as well.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>cloneDeep</span> <span class=p>}</span> <span class=nx>from</span> <span class=s2>&#34;lodash&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nb>window</span><span class=p>.</span><span class=nx>structuredClone</span> <span class=o>=</span> <span class=nx>cloneDeep</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=firebase-error>Firebase Error</h2><p>We can now continue with Firebase, but another error occurs when calling the <code>fetchAndActivate</code> function:</p><pre tabindex=0><code>failed to fetch and activate remote config FirebaseError: Installations: Could not process request. Application offline.
</code></pre><p>This happens because Firebase checks navigator.onLine to ensure the app is online:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>installationEntry</span><span class=p>.</span><span class=nx>registrationStatus</span> <span class=o>===</span> <span class=nx>RequestStatus</span><span class=p>.</span><span class=nx>NOT_STARTED</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>navigator</span><span class=p>.</span><span class=nx>onLine</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Registration required but app is offline.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kr>const</span> <span class=nx>registrationPromiseWithError</span> <span class=o>=</span> <span class=nb>Promise</span><span class=p>.</span><span class=nx>reject</span><span class=p>(</span>
</span></span><span class=line><span class=cl>      <span class=nx>ERROR_FACTORY</span><span class=p>.</span><span class=nx>create</span><span class=p>(</span><span class=nx>ErrorCode</span><span class=p>.</span><span class=nx>APP_OFFLINE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nx>installationEntry</span><span class=p>,</span>
</span></span><span class=line><span class=cl>      <span class=nx>registrationPromise</span><span class=o>:</span> <span class=nx>registrationPromiseWithError</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>navigator.onLine returns the online status of the browser<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>. In this project, this value is false, so we can override it to ensure our app appears online.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=c1>// @ts-expect-error: navigator.onLine must be true
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nb>window</span><span class=p>.</span><span class=nx>navigator</span><span class=p>[</span><span class=s2>&#34;onLine&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=kc>true</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=it-works>It works</h2><p>Finally, restart your project, and it should work!</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href="https://docs.expo.dev/guides/using-firebase/#:~:text=services%20such%20as-,Authentication%2C%20Firestore%2C%20Realtime%20Database%2C%20and%20Storage,-in%20your%20app">Use Firebase - Expo Documentation</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API>IndexedDB</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3><p><a href=https://stackoverflow.com/a/52051320>Does React Native support Indexed DB?</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4><p><a href=https://github.com/dumbmatter/fakeIndexedDB>fakeIndexedDB</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5><p><a href=https://github.com/facebook/hermes/discussions/1072>Non-ECMAScript JS APIs</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/Navigator/onLine>Navigator: onLine property</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div></article><footer id=footer><div class=footer-left>Copyright &copy; 2024 Hugh(Hui) Liu</div><script src=https://code.iconify.design/2/2.0.4/iconify.min.js></script><script defer src=https://static.cloudflareinsights.com/beacon.min.js data-cf-beacon='{"token": "7f02cdd7074d4e1f8125c11651f47699"}'></script></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script></html>